{% extends "base.html" %}

{% block title %}{{ blueprint.name }} - Grimoire{% endblock %}

{% block content %}
<div class="blueprint-detail">
    <div class="blueprint-header">
        <h1>{{ blueprint.name }}</h1>
        {% if blueprint.tags %}
        <div class="tags">
            {% for tag in blueprint.tags %}
            <span class="tag">{{ tag.name }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    {% if blueprint.description %}
    <div class="description-section">
        <h2>Description</h2>
        <p>{{ blueprint.description }}</p>
    </div>
    {% endif %}

    <div class="metadata-grid">
        <div class="metadata-card">
            <h3>ğŸ“ Dimensions</h3>
            <p>{{ blueprint.width }} x {{ blueprint.height }} tiles</p>
        </div>
        <div class="metadata-card">
            <h3>ğŸ”§ Total Entities</h3>
            <p>{{ blueprint.entity_count }}</p>
        </div>
        <div class="metadata-card">
            <h3>ğŸ® Game Version</h3>
            <p>{{ blueprint.version_major }}.{{ blueprint.version_minor }}.{{ blueprint.version_patch }}</p>
        </div>
        <div class="metadata-card">
            <h3>ğŸ“… Created</h3>
            <p>{{ blueprint.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
        </div>
    </div>

    {% if blueprint.entities %}
    <div class="entities-section">
        <h2>Entities Used</h2>
        <div class="entities-list">
            {% for entity in blueprint.entities %}
            <div class="entity-item">
                <span class="entity-name">{{ entity.entity_name }}</span>
                <span class="entity-count">{{ entity.entity_count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="blueprint-string-section">
        <h2>Blueprint String</h2>
        <div class="blueprint-string-container">
            <textarea id="blueprint-string" readonly>{{ blueprint.blueprint_string }}</textarea>
            <button onclick="copyToClipboard()" class="btn btn-primary">ğŸ“‹ Copy to Clipboard</button>
        </div>
    </div>

    <div class="actions">
        <a href="/" class="btn">â† Back to Home</a>
        <button onclick="deleteBlueprint()" class="btn btn-danger">ğŸ—‘ï¸ Delete</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard() {
    const textarea = document.getElementById('blueprint-string');
    textarea.select();
    document.execCommand('copy');
    alert('Blueprint copied to clipboard!');
}

async function deleteBlueprint() {
    if (!confirm('Are you sure you want to delete this blueprint?')) {
        return;
    }

    try {
        const response = await fetch('/api/blueprints/{{ blueprint.id }}', {
            method: 'DELETE'
        });

        if (response.ok) {
            alert('Blueprint deleted successfully!');
            window.location.href = '/';
        } else {
            alert('Failed to delete blueprint');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}
</script>
{% endblock %}
